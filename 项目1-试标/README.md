# 电商订单履约与库存管理系统

## 项目介绍

这是一个针对电商平台核心业务场景的订单履约与库存扣减管理系统，聚焦用户普通下单到订单履约的全流程，核心保障库存数据精准性、杜绝超卖问题，可作为单机运行的Demo演示电商核心履约逻辑。

## 技术栈

- **前端**：HTML + CSS + JavaScript
- **后端**：Node.js + Express
- **数据库**：JSON本地存储（便于演示）
- **单机可运行**：无需外部依赖，直接启动即可使用

## 核心功能

### 1. 订单提交模块
- 接收用户下单请求（包含商品ID、购买数量、用户信息）
- 触发库存预校验逻辑
- 生成待支付订单（含唯一订单号、下单时间、商品信息、库存锁定标识）
- 拦截超卖场景（购买数量＞可用库存时直接返回下单失败）

### 2. 库存扣减模块
- 库存预锁定：用户提交订单后，立即锁定对应商品库存
- 库存实际扣减：订单支付完成后，将锁定库存转为实际扣减
- 库存回滚：订单超时未支付/取消支付时，释放锁定的库存
- 库存数据实时查询：展示商品总库存、可用库存、锁定库存、已扣减库存

### 3. 订单支付校验模块
- 模拟订单支付接口（支持“支付成功/支付失败/超时未支付”三种状态）
- 支付状态与库存扣减联动：仅支付成功后执行实际库存扣减
- 支付结果持久化存储（记录支付时间、支付状态、支付金额）

### 4. 订单履约模块
- 支付成功后自动将订单状态更新为“待履约”
- 支持手动触发“履约中/履约完成/履约失败”状态变更
- 履约状态日志记录（含状态变更时间、操作人、变更原因）

### 5. 数据可视化展示
- 商品库存实时看板（总库存、可用库存、锁定库存）
- 订单状态统计（待支付/已支付/履约中/已履约/已取消）
- 下单/扣减/履约操作日志（含操作时间、操作类型、关联订单/商品ID）

## 项目结构

```
项目1-试标/
├── backend/
│   └── server.js        # 后端Express服务器
├── frontend/
│   └── index.html       # 前端HTML界面
├── data/
│   ├── products.json    # 商品库存数据
│   ├── orders.json      # 订单数据
│   └── logs.json        # 操作日志数据
├── package.json         # 项目配置和依赖
└── README.md            # 项目说明文档
```

## 安装说明

1. **确保已安装Node.js**
   - 本项目需要Node.js环境，建议使用Node.js 14.x或更高版本
   - 可从官网下载安装：https://nodejs.org/

2. **安装项目依赖**
   ```bash
   # 进入项目目录
   cd 项目1-试标
   
   # 安装依赖
   npm install
   ```

## 启动命令

```bash
# 启动服务器
npm start

# 或使用开发模式
npm run dev
```

服务器启动后，会在控制台显示：
```
服务器运行在 http://localhost:3000
```

## 使用说明

1. **访问系统**
   - 在浏览器中打开：http://localhost:3000
   - 即可看到系统登录界面

2. **系统功能使用**

   ### 数据看板
   - 查看库存概览：展示所有商品的可用库存
   - 查看订单统计：展示不同状态的订单数量

   ### 库存管理
   - 查看详细库存数据：总库存、可用库存、锁定库存、已扣减库存
   - 重置库存：点击顶部"重置库存"按钮，恢复初始库存状态

   ### 订单管理
   - 查看所有订单列表
   - 对"待支付"订单进行模拟支付
   - 对"已支付"订单进行履约操作

   ### 操作日志
   - 查看所有系统操作日志
   - 包括订单提交、支付、履约等操作记录

3. **完整流程测试**

   1. **模拟下单**
      - 点击顶部"模拟下单"按钮
      - 选择商品、填写购买数量和用户信息
      - 点击"提交订单"

   2. **模拟支付**
      - 在订单列表中找到刚创建的订单
      - 点击"模拟支付"按钮
      - 选择支付状态（支付成功/支付失败/超时未支付）
      - 点击"确认支付"

   3. **订单履约**
      - 支付成功后，订单状态变为"已支付"
      - 点击"订单履约"按钮
      - 选择履约状态（履约成功/履约失败）
      - 点击"确认履约"

   4. **查看库存变化**
      - 下单后：可用库存减少，锁定库存增加
      - 支付成功：锁定库存减少，已扣减库存增加
      - 支付失败/超时：锁定库存释放，可用库存恢复

## 核心业务逻辑

### 1. 库存预锁定机制
- 用户提交订单时，系统会立即锁定对应商品的库存
- 锁定期间，该库存不可被其他订单占用
- 防止超卖问题的发生

### 2. 库存扣减逻辑
- 只有支付成功的订单才会实际扣减库存
- 支付失败或超时的订单会释放锁定的库存
- 确保库存数据的准确性

### 3. 订单状态流转
- 待支付 → 已支付/已取消
- 已支付 → 已履约/履约失败

### 4. 数据一致性保证
- 所有操作都有详细的日志记录
- 库存变更与订单状态变更保持同步
- 系统重启后数据不丢失（使用本地JSON存储）

## 注意事项

1. **本系统为演示版本**，仅用于展示电商核心履约逻辑
2. **数据存储**使用本地JSON文件，不适合生产环境使用
3. **支付功能**为模拟接口，仅用于演示支付状态对库存的影响
4. **库存重置**会清空所有订单数据，请谨慎操作

## 扩展建议

1. **生产环境改造**
   - 将JSON存储替换为MySQL/PostgreSQL等关系型数据库
   - 增加Redis缓存提升性能
   - 实现分布式锁确保高并发下的库存一致性

2. **功能扩展**
   - 增加用户认证系统
   - 实现真实的支付接口集成
   - 添加更多商品管理功能
   - 实现订单批量处理

3. **性能优化**
   - 实现库存预占超时自动释放机制
   - 增加数据库索引提升查询性能
   - 实现接口缓存减少重复计算

## 故障排查

1. **服务器启动失败**
   - 检查Node.js是否正确安装
   - 检查端口3000是否被占用
   - 查看控制台错误信息

2. **页面无法访问**
   - 检查服务器是否正常运行
   - 检查网络连接是否正常
   - 确认访问地址是否正确（http://localhost:3000）

3. **库存数据异常**
   - 点击"重置库存"按钮恢复初始状态
   - 检查操作日志，查看库存变更记录

4. **订单提交失败**
   - 检查商品库存是否充足
   - 检查填写的订单信息是否完整
   - 查看浏览器控制台错误信息

## 总结

本系统完整实现了电商平台的核心履约逻辑，包括订单提交、库存锁定、支付处理、库存扣减和订单履约等关键环节。通过本地JSON存储和模拟接口，确保了系统的可移植性和易用性，可作为电商系统核心逻辑的教学演示工具。

系统设计遵循了电商业务的最佳实践，特别是在库存管理方面，通过预锁定机制有效防止了超卖问题，保证了库存数据的准确性。同时，完整的订单状态流转和操作日志记录，为系统的可追溯性提供了保障。